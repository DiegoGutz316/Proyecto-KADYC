@model Proyecto_v1.Models.Category

@{
    ViewData["Title"] = "Eliminar Categoría";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="~/css/crud-responsive.css" asp-append-version="true" />
<link rel="stylesheet" href="~/css/categories-crud.css" asp-append-version="true" />

<div class="crud-container">
    <!-- Header -->
    <div class="crud-header">
        <h1 class="crud-title">
            <i class="fas fa-trash-alt"></i>
            Eliminar Categoría
        </h1>
        <div class="crud-actions">
            <a asp-action="Index" class="crud-btn crud-btn--secondary">
                <i class="fas fa-arrow-left"></i>
                Volver a la Lista
            </a>
            <a asp-action="Details" asp-route-id="@Model.Id" class="crud-btn crud-btn--outline">
                <i class="fas fa-eye"></i>
                Ver Detalles
            </a>
        </div>
    </div>

    <div class="crud-form-container delete-container">
        <div class="crud-form-header">
            <h2 class="crud-form-title text-danger">
                <i class="fas fa-exclamation-triangle"></i>
                Confirmar Eliminación
            </h2>
            <p class="crud-form-subtitle">
                ¿Estás seguro de que deseas eliminar permanentemente la categoría "<strong>@Model.Name</strong>"?
            </p>
        </div>

        <!-- Información de la categoría -->
        <div class="delete-info-grid">
            <div class="info-card">
                <div class="info-card-header">
                    <i class="fas fa-info-circle"></i>
                    <h3>Información de la Categoría</h3>
                </div>
                <div class="info-card-body">
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-tag"></i>
                            Nombre:
                        </span>
                        <span class="detail-value">@Html.DisplayFor(model => model.Name)</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-hashtag"></i>
                            ID:
                        </span>
                        <span class="detail-value">#@Model.Id</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">
                            <i class="fas fa-toggle-on"></i>
                            Estado:
                        </span>
                        <span class="detail-value">
                            @if (Model.IsActive)
                            {
                                <span class="status-badge status-badge--active">
                                    <i class="fas fa-check"></i> Activa
                                </span>
                            }
                            else
                            {
                                <span class="status-badge status-badge--inactive">
                                    <i class="fas fa-times"></i> Inactiva
                                </span>
                            }
                        </span>
                    </div>
                </div>
            </div>

            <!-- Impacto de la eliminación -->
            <div class="impact-card">
                <div class="info-card-header warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Impacto de la Eliminación</h3>
                </div>
                <div class="info-card-body">
                    @{
                        var productCount = Model.Products?.Count ?? 0;
                        var activeProducts = Model.Products?.Count(p => p.IsActive) ?? 0;
                    }
                    
                    <div class="impact-item">
                        <div class="impact-icon products">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="impact-info">
                            <span class="impact-number">@productCount</span>
                            <span class="impact-label">Productos asociados</span>
                        </div>
                    </div>
                    
                    @if (productCount > 0)
                    {
                        <div class="warning-message">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>¡Atención!</strong>
                                <p>
                                    Esta categoría tiene <strong>@productCount productos</strong> asociados.
                                    Al eliminarla, estos productos quedarán sin categoría asignada.
                                </p>
                            </div>
                        </div>
                        
                        <div class="products-preview">
                            <h4>Productos que se verán afectados:</h4>
                            <div class="affected-products">
                                @foreach (var product in Model.Products.Take(3))
                                {
                                    <div class="affected-product">
                                        <i class="fas fa-box"></i>
                                        <span>@product.Name</span>
                                    </div>
                                }
                                @if (productCount > 3)
                                {
                                    <div class="affected-product more">
                                        <i class="fas fa-ellipsis-h"></i>
                                        <span>Y @(productCount - 3) más...</span>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="safe-message">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <strong>Eliminación segura</strong>
                                <p>Esta categoría no tiene productos asociados, por lo que se puede eliminar sin afectar otros datos.</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Alternativas -->
        @if (productCount > 0)
        {
            <div class="alternatives-section">
                <div class="alternatives-header">
                    <i class="fas fa-lightbulb"></i>
                    <h3>Alternativas Recomendadas</h3>
                </div>
                <div class="alternatives-content">
                    <div class="alternative-option">
                        <div class="alternative-icon">
                            <i class="fas fa-toggle-off"></i>
                        </div>
                        <div class="alternative-info">
                            <h4>Desactivar en lugar de eliminar</h4>
                            <p>Mantén la categoría pero marca como inactiva. Los productos conservarán su relación.</p>
                            <a asp-action="Edit" asp-route-id="@Model.Id" class="crud-btn crud-btn--outline crud-btn--small">
                                <i class="fas fa-edit"></i>
                                Desactivar Categoría
                            </a>
                        </div>
                    </div>
                    <div class="alternative-option">
                        <div class="alternative-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="alternative-info">
                            <h4>Reasignar productos primero</h4>
                            <p>Cambia los productos a otra categoría antes de eliminar esta.</p>
                            <a asp-controller="Products" asp-action="Index" class="crud-btn crud-btn--outline crud-btn--small">
                                <i class="fas fa-boxes"></i>
                                Gestionar Productos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Confirmación final -->
        <div class="confirmation-section">
            <form asp-action="Delete" id="deleteForm">
                <input type="hidden" asp-for="Id" />
                
                <div class="confirmation-checkbox">
                    <label class="checkbox-container">
                        <input type="checkbox" id="confirmDelete" required>
                        <span class="checkmark"></span>
                        <span class="checkbox-text">
                            Entiendo que esta acción no se puede deshacer y acepto eliminar permanentemente la categoría.
                        </span>
                    </label>
                </div>

                <div class="form-actions">
                    <button type="submit" class="crud-btn crud-btn--danger" id="deleteBtn" disabled>
                        <i class="fas fa-trash"></i>
                        Eliminar Definitivamente
                    </button>
                    <a asp-action="Details" asp-route-id="@Model.Id" class="crud-btn crud-btn--outline">
                        <i class="fas fa-eye"></i>
                        Ver Detalles
                    </a>
                    <a asp-action="Index" class="crud-btn crud-btn--secondary">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmCheckbox = document.getElementById('confirmDelete');
    const deleteBtn = document.getElementById('deleteBtn');
    const deleteForm = document.getElementById('deleteForm');
    
    // Habilitar/deshabilitar botón según checkbox
    confirmCheckbox.addEventListener('change', function() {
        deleteBtn.disabled = !this.checked;
        if (this.checked) {
            deleteBtn.classList.add('enabled');
        } else {
            deleteBtn.classList.remove('enabled');
        }
    });
    
    // Confirmación adicional al enviar
    deleteForm.addEventListener('submit', function(e) {
        if (!confirm('¿Estás completamente seguro? Esta acción eliminará permanentemente la categoría "@Model.Name".')) {
            e.preventDefault();
            return false;
        }
        
        // Cambiar texto del botón
        deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Eliminando...';
        deleteBtn.disabled = true;
    });
});
</script>
