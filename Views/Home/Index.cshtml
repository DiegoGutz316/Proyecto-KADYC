@model IEnumerable<Proyecto_v1.Models.Product>

@{
    ViewData["Title"] = "KADYC — THE NEW";
    Layout = null; // Usamos layout personalizado para esta página
}

<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>@ViewData["Title"]</title>
  <meta name="description"
    content="KADYC: tienda minimalista (hombres y mujeres), nueva y segunda mano. Portada editorial." />
    <link rel="stylesheet" href="~/css/styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/featured-products.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <!-- Botón flotante para formulario de contacto y catalogo -->
    <div class="kad-floating-form-cta">
      <a class="kad-btn kad-btn--solid" href="#featured-products" aria-label="Ver productos destacados">Ver destacados</a>
      <button id="open-contact-form" class="kad-btn kad-btn--outline" aria-label="Abrir formulario de contacto">Contáctanos</button>
      @if (User.Identity.IsAuthenticated)
      {
        <a class="kad-btn kad-btn--solid" asp-controller="Home" asp-action="ViewProducts">Todos los Productos</a>
      }
      else
      {
        <a class="kad-btn kad-btn--solid" asp-area="Identity" asp-page="/Account/Login">Iniciar Sesión</a>
      }
    </div>

    <div id="kad-form-modal" class="kad-form-modal" style="display:none;">
      <div class="kad-form-modal__backdrop"></div>
      <div class="kad-form-modal__content">
        <button id="close-contact-form" class="kad-btn kad-btn--ghost" style="float:right">×</button>
        <form id="kad-form" class="kad-form" novalidate>
          <div class="kad-field">
            <label for="kad-nombre">Nombre *</label>
            <input id="kad-nombre" name="nombre" required minlength="2" autocomplete="name">
            <small class="kad-error" aria-live="polite"></small>
          </div>
          <div class="kad-field">
            <label for="kad-correo">Correo *</label>
            <input id="kad-correo" name="correo" type="email" required autocomplete="email">
            <small class="kad-error" aria-live="polite"></small>
          </div>
          <div class="kad-field">
            <label for="kad-tel">Teléfono *</label>
            <input id="kad-tel" name="tel" type="tel" required pattern="\+?\d{7,15}" autocomplete="tel">
            <small class="kad-error" aria-live="polite"></small>
          </div>
          <div class="kad-field">
            <label for="kad-msg">Mensaje *</label>
            <textarea id="kad-msg" name="msg" required minlength="10" rows="4"></textarea>
            <small class="kad-error" aria-live="polite"></small>
          </div>
          <div class="kad-field" style="position:absolute;left:-9999px">
            <label for="kad-company">Company</label>
            <input id="kad-company" name="company" type="text" tabindex="-1" autocomplete="off">
          </div>
          
          <button class="kad-btn kad-btn--solid" type="submit">Enviar</button>
          <div id="kad-status" aria-live="polite"></div>
        </form>
      </div>
    </div>
  <!-- TOP BAR -->
  <div class="topbar" role="navigation" aria-label="Barra superior">
    <button class="burger" title="Menú" aria-label="Abrir menú" aria-controls="site-menu" aria-expanded="false">
      <span></span><span></span><span></span>
    </button>

    <div class="logo" aria-label="KADYC logo">KADYC</div>
    <div class="right">
      @if (User.Identity.IsAuthenticated)
      {
        <span>Hola, @User.Identity.Name</span>
        @if (User.IsInRole("Admin"))
        {
          <a asp-area="" asp-controller="Categories" asp-action="Index">Categorías</a>
          <a asp-area="" asp-controller="Products" asp-action="Index">Productos</a>
        }
        <a asp-controller="Cart" asp-action="Index" class="cart-link">
          <i class="fas fa-shopping-cart"></i> CESTA <span id="cart-count">[0]</span>
        </a>
        <form method="post" asp-area="Identity" asp-page="/Account/Logout" style="display:inline;">
          <button type="submit" class="btn-link" style="border:none; background:none; text-decoration:underline; cursor:pointer;">CERRAR SESIÓN</button>
        </form>
      }
      else
      {
        <a asp-area="Identity" asp-page="/Account/Login">INICIAR SESIÓN</a>
        <a asp-area="Identity" asp-page="/Account/Register">REGISTRO</a>
        <a href="javascript:void(0)" onclick="showLoginRequired()" class="cart-link-disabled">
          <i class="fas fa-shopping-cart"></i> CESTA [0]
        </a>
      }
    </div>
  </div>

  <!-- Drawer -->
  <div class="menu-backdrop" hidden></div>
  <aside id="site-menu" class="drawer" aria-hidden="true">
    <div class="drawer-header">
      <div class="logo">KADYC</div>
      <button class="drawer-close" aria-label="Cerrar menú">X</button>
    </div>
    <nav class="drawer-nav" aria-label="Menú principal">
      @if (User.Identity.IsAuthenticated)
      {
        <a asp-controller="Home" asp-action="ViewProducts" data-link>VER PRODUCTOS</a>
        <a asp-controller="Cart" asp-action="Index" data-link>
          <i class="fas fa-shopping-cart"></i> MI CARRITO <span id="cart-count-drawer">[0]</span>
        </a>
        @if (User.IsInRole("Admin"))
        {
          <a asp-controller="Products" asp-action="Index" data-link>GESTIONAR PRODUCTOS</a>
          <a asp-controller="Categories" asp-action="Index" data-link>GESTIONAR CATEGORÍAS</a>
        }
      }
      else
      {
        <a asp-area="Identity" asp-page="/Account/Login" data-link>INICIAR SESIÓN</a>
        <a asp-area="Identity" asp-page="/Account/Register" data-link>REGISTRARSE</a>
        <a href="javascript:void(0)" onclick="showLoginRequired()" data-link>
          <i class="fas fa-shopping-cart"></i> MI CARRITO
        </a>
      }
      <a href="#mujer" data-link>MUJER</a>
      <a href="#hombre" data-link>HOMBRE</a>
      <a href="#segunda" data-link>SEGUNDA MANO</a>
      <a href="#novedades" data-link>NOVEDADES</a>
    </nav>
    <div class="drawer-right">
      <img src="https://i.pinimg.com/736x/4b/88/f4/4b88f47c2f019c91cd34437e627efab0.jpg" alt="Editorial KADYC"
        loading="lazy" />
    </div>
  </aside>

  <!-- PRIMERA VISTA -->
  <section class="intro" id="inicio" aria-labelledby="main-title">
    <div class="intro-center">
      <div class="kicker">DESPLÁZATE HACIA ABAJO</div>
      <h1 id="main-title" class="title">THE NEW</h1>
      <div class="scroll-wrap">
        <div class="scroll-indicator"></div>
      </div>
    </div>
    <div class="newsletter-mini">ÚNETE A NUESTRA NEWSLETTER</div>
  </section>

  <!-- DOBLE HERO -->
  <main class="hero" id="hero">
    <div class="hero-grid">
      <div>
        <div class="frame" style="
              background-image: url('https://i.pinimg.com/736x/32/a7/8d/32a78deb4fea51fe7c52213cbfb525ca.jpg');
            " role="img" aria-label="Editorial look 1"></div>
      </div>
      <div>
        <div class="frame" style="
              background-image: url('https://i.pinimg.com/736x/d3/9a/1b/d39a1bde4cffa143b3fa2d506abcd61a.jpg');
            " role="img" aria-label="Editorial look 2"></div>
        <div class="caption">
          THE NEW · KADYC COLLECTION · FALL/WINTER 2025
        </div>
      </div>
    </div>
  </main>

  <!-- SECCIÓN DE PRODUCTOS DESTACADOS -->
  <section class="featured-products" id="featured-products">
    <div class="kad-wrap">
      <header class="featured-header">
        <h2 class="featured-title">Productos Destacados</h2>
        <p class="featured-subtitle">Descubre nuestras piezas más populares y nuevas llegadas</p>
      </header>
      
      @if (Model != null && Model.Any())
      {
        <div class="featured-grid">
          @foreach (var producto in Model)
          {
            <article class="featured-card" data-category="@producto.Category?.Name">
              <div class="featured-image">
                @if (!string.IsNullOrEmpty(producto.ImageUrl))
                {
                  <img src="@producto.ImageUrl" alt="@producto.Name" loading="lazy">
                }
                else
                {
                  <div class="featured-placeholder">
                    <i class="fas fa-image"></i>
                  </div>
                }
                <div class="featured-overlay">
                  @if (User.Identity.IsAuthenticated)
                  {
                    <form method="post" asp-controller="Cart" asp-action="AddToCart" class="add-to-cart-quick">
                      <input type="hidden" name="productId" value="@producto.Id">
                      <input type="hidden" name="quantity" value="1">
                      <button type="submit" class="quick-add-btn" title="Agregar al carrito">
                        <i class="fas fa-shopping-cart"></i>
                      </button>
                    </form>
                  }
                  <a href="@Url.Action("DetallesProducto", "Home", new { id = producto.Id })" class="quick-view-btn" title="Ver detalles">
                    <i class="fas fa-eye"></i>
                  </a>
                </div>
              </div>
              <div class="featured-info">
                <span class="featured-category">@producto.Category?.Name</span>
                <h3 class="featured-name">@producto.Name</h3>
                <p class="featured-description">@producto.Description</p>
                <div class="featured-price-wrapper">
                  <span class="featured-price">?@producto.Price.ToString("N0")</span>
                  @if (producto.Stock > 0)
                  {
                    <span class="featured-stock">@producto.Stock disponibles</span>
                  }
                  else
                  {
                    <span class="featured-stock out-of-stock">Agotado</span>
                  }
                </div>
              </div>
            </article>
          }
        </div>
        
        <div class="featured-cta">
          @if (User.Identity.IsAuthenticated)
          {
            <a href="@Url.Action("ViewProducts", "Home")" class="kad-btn kad-btn--outline kad-btn--large">
              Ver Todos los Productos
            </a>
          }
          else
          {
            <a href="@Url.Page("/Account/Login", new { area = "Identity" })" class="kad-btn kad-btn--outline kad-btn--large">
              Iniciar Sesión para Ver Más
            </a>
          }
        </div>
      }
      else
      {
        <div class="featured-empty">
          <i class="fas fa-box-open"></i>
          <h3>Próximamente</h3>
          <p>Estamos preparando increíbles productos para ti. ¡Vuelve pronto!</p>
        </div>
      }
    </div>
  </section>

  <script src="~/js/script.js" asp-append-version="true"></script>
  <!-- Testimonios/Confianza -->
  <section id="confianza" class="kad-section">
    <div class="kad-wrap">
      <header>
        <h2>Comentarios destacados de nuestros clientes</h2>

      </header>
      <div class="kad-testimonials-grid">
        <article class="kad-testimonial-card">
          <p class="kad-testimonial-text">"¡Increíble calidad y servicio! Encontré piezas únicas que no hallaba en
            ningún otro lugar. KADYC es mi nueva tienda favorita."</p>
          <p class="kad-testimonial-author">— Sofía M.</p>
        </article>
        <article class="kad-testimonial-card">
          <p class="kad-testimonial-text">"El proceso de compra fue súper sencillo y la entrega rapidísima. La ropa de
            segunda mano está en perfectas condiciones. ¡Muy recomendado!"</p>
          <p class="kad-testimonial-author">— Carlos R.</p>
        </article>
        <article class="kad-testimonial-card">
          <p class="kad-testimonial-text">"Me encanta la misión de KADYC de apoyar a pequeños emprendedores. Es una
            plataforma con propósito y productos de alta calidad."</p>
          <p class="kad-testimonial-author">— Maria P.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="site-footer" id="footer" role="contentinfo">
    <div class="footer-grid" aria-label="Información del sitio">

      <!-- Columna 1: About -->
      <section class="footer-col">
        <h3 class="footer-title">About us</h3>
        <details class="footer-accordion" name="footer-accordion">
          <summary class="footer-summary">Quiénes somos</summary>
          <div class="footer-panel">
            <p class="footer-text">
              KADYC es un espacio digital para emprendedores de moda —nueva y segunda mano—
              donde los clientes encuentran variedad, calidad y precios accesibles.
            </p>
          </div>
        </details>

        <details class="footer-accordion" name="footer-accordion" open>
          <summary class="footer-summary">Misión y Visión de KADYC</summary>
          <summary class="footer-summary">Misión</summary>
          <div class="footer-panel">
            <p class="footer-text">
              Brindar un espacio confiable e innovador para ofrecer prendas nuevas y de segunda mano,
              fomentando la colaboración y el crecimiento conjunto.
            </p>
            </div>
            <summary class="footer-summary">Visión</summary>
            <div class="footer-panel">
              <p class="footer-text">
                Consolidarnos como una plataforma de referencia en el comercio digital de moda, impulsando a
                pequeños emprendimientos a crecer y posicionarse, y convirtiéndonos en un punto de encuentro
                inclusivo, sostenible y reconocido a nivel nacional.
              </p>
            </div>
        </details>
      </section>

      <!-- Columna 2: Client Services -->
      <section class="footer-col">
        <h3 class="footer-title">Client Services</h3>
        <details class="footer-accordion" name="footer-accordion" open>
          <summary class="footer-summary">Contacto</summary>
          <nav class="footer-panel footer-list" aria-label="Opciones de contacto">
            <a href="#contacto">Formulario</a>
            <a href="mailto:contacto@kadyc.com">Email</a>
            <a href="tel:+50600000000">Teléfono</a>
          </nav>
        </details>

        <details class="footer-accordion" name="footer-accordion">
          <summary class="footer-summary">Ayuda y devoluciones</summary>
          <nav class="footer-panel footer-list">
            <a href="#faq">Preguntas frecuentes</a>
            <a href="#envios">Envíos</a>
            <a href="#devoluciones">Devoluciones</a>
          </nav>
        </details>
      </section>

      <!-- Columna 3: Store Locator -->
      <details class="footer-accordion" name="footer-accordion" open>
        <summary class="footer-summary">Ubicación</summary>
        <nav class="footer-panel footer-list" aria-label="Ubicaciones">
          <a href="https://maps.app.goo.gl/1HecDr4HAfbERMN89" target="_blank" rel="noopener noreferrer">
            Costa Rica - Nicoya
          </a>
        </nav>
      </details>

      <!-- Columna 4: Legal -->
      <section class="footer-col">
        <h3 class="footer-title">Legal</h3>

        <details class="footer-accordion" name="footer-accordion" open>
          <summary class="footer-summary">Términos y Políticas</summary>
          <nav class="footer-panel footer-list" aria-label="Términos y políticas">
            <a href="politicas/terminos.html">Términos de uso</a>
            <a href="politicas/privacidad.html">Política de Privacidad</a>
            <a href="#condiciones">Condiciones Generales</a>
          </nav>
        </details>

        <details class="footer-accordion" name="footer-accordion">
          <summary class="footer-summary">Mapa del sitio</summary>
          <nav class="footer-panel footer-list" aria-label="Mapa del sitio">
            <a href="#home">Home</a>
            <a href="#mujer">Mujer</a>
            <a href="#hombre">Hombre</a>
            <a href="#segunda">Segunda mano</a>
            <a href="#novedades">Novedades</a>
          </nav>
        </details>
      </section>
    </div>

    <div class="footer-bottom">
      <div class="footer-social" aria-label="Redes sociales">
        <span>Follow Us</span>
        <a href="https://www.instagram.com/kadycstyle_?igsh=b2c4bWYzMmFoZHQ=">Instagram</a>
        <a href="https://wa.me/50600000000">#WhatsApp</a>
        <a href="https://twitter.com">X</a>
      </div>

      <div class="footer-brand" aria-label="Marca">KADYC</div>
      <div class="footer-location" aria-label="Ubicación actual">Costa Rica – Nicoya</div>
    </div>

    <section id="payment-logos" class="kad-section">
      <div class="kad-wrap">
        <div class="kad-payment-logos">
          <div class="kad-logos-container">
            <img
              src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Mastercard-logo.svg/2560px-Mastercard-logo.svg.png"
              alt="Mastercard" loading="lazy">
            <img
              src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/American_Express_logo_%282018%29.svg/1200px-American_Express_logo_%282018%29.svg.png"
              alt="American Express" loading="lazy">
            <img src="https://upload.wikimedia.org/frameworks/commons/a/a4/Paypal_2014_logo.png" alt="PayPal"
              loading="lazy">
            <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png" alt="Visa" loading="lazy">
          </div>
        </div>
      </div>
    </section>
  </footer>

  <!-- Scripts para funcionalidad del carrito -->
  @if (User.Identity.IsAuthenticated)
  {
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        updateCartCount();
        initializeFeaturedProducts();
    });

    function updateCartCount() {
        fetch('@Url.Action("GetCartCount", "Cart")')
            .then(response => response.json())
            .then(count => {
                const cartCount = document.getElementById('cart-count');
                if (cartCount) {
                    cartCount.textContent = '[' + count + ']';
                }
                
                const cartCountDrawer = document.getElementById('cart-count-drawer');
                if (cartCountDrawer) {
                    cartCountDrawer.textContent = '[' + count + ']';
                }
            })
            .catch(error => console.error('Error updating cart count:', error));
    }

    function initializeFeaturedProducts() {
        // Añadir efecto de aparición progresiva
        const featuredCards = document.querySelectorAll('.featured-card');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.classList.add('animate-in');
                    }, index * 100);
                }
            });
        }, { threshold: 0.1 });

        featuredCards.forEach(card => {
            observer.observe(card);
        });

        // Manejar envío de formularios de agregar al carrito
        const quickAddForms = document.querySelectorAll('.add-to-cart-quick');
        quickAddForms.forEach(form => {
            form.addEventListener('submit', function(e) {
                const button = this.querySelector('.quick-add-btn');
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                button.disabled = true;
                
                // Restaurar después de 2 segundos
                setTimeout(() => {
                    button.innerHTML = '<i class="fas fa-shopping-cart"></i>';
                    button.disabled = false;
                    updateCartCount(); // Actualizar contador
                }, 2000);
            });
        });
    }

    window.updateCartCount = updateCartCount;
    </script>
  }
  else
  {
    <script>
    function showLoginRequired() {
        alert('Debes iniciar sesión para acceder al carrito de compras.');
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Animaciones para usuarios no autenticados también
        const featuredCards = document.querySelectorAll('.featured-card');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.classList.add('animate-in');
                    }, index * 100);
                }
            });
        }, { threshold: 0.1 });

        featuredCards.forEach(card => {
            observer.observe(card);
        });
    });
    </script>
  }
</body>

</html>